name: SBOM

on:
    push:
        branches: [main, develop]
    pull_request:
        branches: [main, develop]
    schedule:
        - cron: "0 6 * * 1"
    workflow_dispatch:

permissions:
    contents: read

jobs:
    generate-sbom:
        name: Generate SBOM (CycloneDX for Go)
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v6

            - name: Setup Go
              uses: actions/setup-go@v5
              with:
                  go-version: "1.25"
                  cache: true

            - name: Install CycloneDX Go generator
              run: |
                  go install github.com/CycloneDX/cyclonedx-gomod/cmd/cyclonedx-gomod@latest

            - name: Add Go bin to PATH (to simplify subsequent calls)
              run: echo "$(go env GOPATH)/bin" >> $GITHUB_PATH

            - name: Generate SBOM (JSON)
              run: |
                  cyclonedx-gomod mod \
                    -json \
                    -licenses \
                    -output sbom.json

            - name: Generate SBOM (XML)
              run: |
                  cyclonedx-gomod mod \
                    -licenses \
                    -output sbom.xml

            - name: Upload SBOM artifacts
              uses: actions/upload-artifact@v4
              with:
                  name: sbom
                  path: |
                      sbom.json
                      sbom.xml
